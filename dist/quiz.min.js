window.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll(".quiz-container[src]").forEach(e=>{let t=e.children[0].outerHTML,r=e.children[1].outerHTML;e.innerHTML='<div style="position:relative;height:100%;width:100%;overflow-x:hidden;overflow-y:scroll"></div>';let l=e.querySelector("div");fetch(e.getAttribute("src")).then(e=>e.json()).then(e=>{if(e.questions&&Array.isArray(e.questions)){let i=document.createElement("div");i.style.position="absolute",i.style.left=".5rem",i.style.right=".5rem",i.style.bottom=".5rem",i.style.height="1rem",i.style.display="flex",i.style.gap=".25rem",i.style.alignItems="center",i.style.justifyContent="center",e.shuffle&&(e.questions=e.questions.map(e=>({value:e,sort:Math.random()})).sort((e,t)=>e.sort-t.sort).map(({value:e})=>e)),e.limit&&Number.isInteger(+e.limit)&&(e.questions=e.questions.slice(0,+e.limit)),e.questions.forEach(e=>{let r=document.createElement("section");r.innerHTML=t,r.hidden=!0,r.style.position="absolute",r.style.inset="0",r.style.transition="all .3s ease-in-out",r.querySelectorAll(".title").forEach(t=>t.innerText=e.title),r.querySelectorAll(".text").forEach(t=>t.innerText=e.text);let o=r.querySelector(".quiz-option").outerHTML,n=r.querySelector(".quiz-options"),s=document.createElement("div");n&&e.options&&Array.isArray(e.options)&&(n.innerHTML="",e.options.forEach(e=>{s.innerHTML=o,Array.from(s.querySelector("*").childNodes).filter(e=>e.nodeType==Node.TEXT_NODE).forEach(t=>t.nodeValue=e.text),s.querySelector("input[type=radio]").val=e.points,n.appendChild(s.children[0])})),l.appendChild(r);let c=document.createElement("div");c.title=e.title,c.hidden=!0,c.style.width=".5rem",c.style.height=".5rem",c.style.borderRadius=".25rem",c.style.cursor="pointer",c.style.backgroundColor="rgba(0,0,0,.5)",c.addEventListener("click",e=>{l.querySelectorAll("section").forEach(e=>e.hidden=!0),r.style.transform="translate(100%)",r.hidden=!1,c.hidden=!1,setTimeout(e=>r.style.transform="",0)}),i.appendChild(c)}),e.navigable||(i.hidden=!0);let o=document.createElement("section");o.innerHTML=r,o.hidden=!0,o.style.position="absolute",o.style.inset="0",o.style.transition="all .3s ease-in-out";let n=document.createElement("div");n.hidden=!0,n.style.width=".5rem",n.style.height=".5rem",n.style.cursor="pointer",n.style.backgroundColor="rgba(0,0,0,.5)",n.addEventListener("click",t=>{if(l.querySelectorAll("section").forEach(e=>e.hidden=!0),o.style.transform="translate(100%)",e.results&&Array.isArray(e.results)){let r=Array.from(l.querySelectorAll("input:checked")).reduce((e,t)=>e+t.val,0);e.results.forEach(e=>{e.min<=r&&(o.querySelectorAll(".title").forEach(t=>t.innerText=e.title),o.querySelectorAll(".text").forEach(t=>t.innerText=e.text),e.image&&o.querySelectorAll(".image").forEach(t=>t.src=e.image))})}o.hidden=!1,n.hidden=!1,setTimeout(e=>o.style.transform="",0)}),l.appendChild(o),i.appendChild(n),l.appendChild(i),l.querySelectorAll(".quiz-option").forEach(e=>{let t=Array.from(l.querySelectorAll(".quiz-container>div>section")).indexOf(e.closest(".quiz-container>div>section"));e.querySelectorAll("input[type=radio").forEach(e=>e.name="opt-"+t),e.addEventListener("click",e=>{i.querySelectorAll("div")[t+1].click()})}),i.querySelector("div").click()}else console.log("Invalid source - no questions")}).catch(e=>console.error(e))})});
